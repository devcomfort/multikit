---
description: "í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ë¶„ì„ ë° ë³´ì™„ â€” ì»¤ë²„ë¦¬ì§€ ê°­ì„ ë¶„ë¥˜í•˜ê³ , í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ë©°, êµ¬ì¡°ì ìœ¼ë¡œ ì»¤ë²„ ë¶ˆê°€í•œ ì½”ë“œë¥¼ íˆ¬ëª…í•˜ê²Œ ë³´ê³ í•©ë‹ˆë‹¤."
handoffs:
  - label: í…ŒìŠ¤íŠ¸ ì„¤ê³„ë¶€í„° ì‹œì‘
    agent: testkit.testdesign
    prompt: ì½”ë“œë² ì´ìŠ¤ë¥¼ ë¶„ì„í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì„¤ê³„ ë¬¸ì„œë¥¼ ë¨¼ì € ì‘ì„±í•©ë‹ˆë‹¤.
---

## User Input

$ARGUMENTS

You **MUST** consider the user input before proceeding (if not empty).

---

## Philosophy Alignment

ì´ ì—ì´ì „íŠ¸ëŠ” `testkit.testdesign`ì˜ **Reliable Engineering** ì² í•™ì„ ì‹¤í–‰ ë‹¨ê³„ì—ì„œ êµ¬í˜„í•©ë‹ˆë‹¤.

í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ë•Œ ë°˜ë“œì‹œ ë‹¤ìŒ ì›ì¹™ì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤:

| #   | Principle             | ì‹¤í–‰ ì‹œ ì ìš© ë°©ë²•                                           |
| --- | --------------------- | ----------------------------------------------------------- |
| 1   | **Deterministic**     | ëª¨í‚¹ëœ ì˜ì¡´ì„±, ê³ ì •ëœ ì…ë ¥/ì¶œë ¥ìœ¼ë¡œ í•­ìƒ ë™ì¼í•œ ê²°ê³¼ ë³´ì¥   |
| 2   | **Isolated**          | ê° í…ŒìŠ¤íŠ¸ëŠ” ë…ë¦½ì  fixture ì‚¬ìš©, ê³µìœ  ìƒíƒœ ê¸ˆì§€             |
| 3   | **Fail-Fast**         | assertion ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ì›ì¸ì„ íŒŒì•…í•  ìˆ˜ ìˆëŠ” ë©”ì‹œì§€ í¬í•¨    |
| 4   | **Boundary-Aware**    | ì»¤ë²„ë¦¬ì§€ ê°­ ë¶„ì„ ì‹œ ê²½ê³„ê°’ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìš°ì„  í™•ì¸             |
| 5   | **Contract-Driven**   | í…ŒìŠ¤íŠ¸ê°€ í•¨ìˆ˜ì˜ ê³„ì•½(ì‚¬ì „/ì‚¬í›„/ë¶ˆë³€ ì¡°ê±´)ì„ ê²€ì¦í•˜ëŠ”ì§€ í™•ì¸ |
| 6   | **Error Path Parity** | ì˜¤ë¥˜ ê²½ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì •ìƒ ê²½ë¡œì™€ ë™ë“±í•œ ë¹„ì¤‘ìœ¼ë¡œ ì‘ì„±         |
| 7   | **Observable**        | í…ŒìŠ¤íŠ¸ ì´ë¦„ê³¼ assertionì´ ì˜ë„ë¥¼ ëª…í™•íˆ ì „ë‹¬                |

---

## Goal

í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ë¥¼ ì¸¡ì •í•˜ê³ , ê° ë¯¸ì»¤ë²„ ë¼ì¸ì„ ë¶„ë¥˜í•˜ì—¬, ì»¤ë²„ ê°€ëŠ¥í•œ ê²½ë¡œì— ëŒ€í•´ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
êµ¬ì¡°ì ìœ¼ë¡œ ì»¤ë²„í•  ìˆ˜ ì—†ëŠ” ì½”ë“œëŠ” `# pragma: no cover`ì™€ í•¨ê»˜ ì‚¬ìœ ë¥¼ íˆ¬ëª…í•˜ê²Œ ê¸°ë¡í•©ë‹ˆë‹¤.

> **í•µì‹¬ ëª©í‘œëŠ” ìˆ«ì(100%)ê°€ ì•„ë‹Œ ê°•ê±´ì„±(robustness)ì˜ í™•ë³´ì…ë‹ˆë‹¤.**
> ì»¤ë²„ë¦¬ì§€ëŠ” ì‹ ë¢°ì„±ì˜ ì§€í‘œì´ì§€, ëª©ì  ìì²´ê°€ ì•„ë‹™ë‹ˆë‹¤.

---

## Operating Constraints

- **Language**: ì‚¬ìš©ì ì…ë ¥ ì–¸ì–´ë¥¼ ë”°ë¦…ë‹ˆë‹¤. ë¶ˆë¶„ëª…í•˜ë©´ í•œêµ­ì–´ë¡œ ì‘ë‹µí•©ë‹ˆë‹¤.
- **Test Runner**: í”„ë¡œì íŠ¸ ì„¤ì •(`pyproject.toml`, `package.json` ë“±)ì—ì„œ ìë™ ê°ì§€í•©ë‹ˆë‹¤.
- **Safety**: ì†ŒìŠ¤ ì½”ë“œì˜ **ë¡œì§ì„ ìˆ˜ì •í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. í…ŒìŠ¤íŠ¸ ì¶”ê°€ì™€ `# pragma: no cover` ì£¼ì„ë§Œ í—ˆìš©ë©ë‹ˆë‹¤.
- **Transparency**: ëª¨ë“  `# pragma: no cover`ì—ëŠ” ë°˜ë“œì‹œ ì¸ë¼ì¸ ì‚¬ìœ ê°€ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

---

## Execution Steps

### Phase 1: Baseline Measurement (ê¸°ì¤€ ì¸¡ì •)

#### 1.1 Detect Test Infrastructure

`pyproject.toml`, `setup.cfg`, `package.json` ë“±ì„ ì½ì–´ ë‹¤ìŒì„ ì‹ë³„í•©ë‹ˆë‹¤:

- í…ŒìŠ¤íŠ¸ ëŸ¬ë„ˆ (pytest, jest, vitest ë“±)
- ì»¤ë²„ë¦¬ì§€ ë„êµ¬ (pytest-cov, coverage.py, istanbul, c8 ë“±)
- ê¸°ì¡´ ì»¤ë²„ë¦¬ì§€ ì„¤ì • (fail-under ì„ê³„ê°’, ì œì™¸ íŒ¨í„´)

#### 1.2 Run Baseline Coverage

í”„ë¡œì íŠ¸ì— ì í•©í•œ ì»¤ë²„ë¦¬ì§€ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤:

- **Python (pytest)**: `python -m pytest --cov=<source_dir> --cov-report=term-missing --cov-branch -q`
- **Node.js (jest)**: `npx jest --coverage --coverageReporters=text`
- **Node.js (vitest)**: `npx vitest run --coverage`

ê²°ê³¼ì—ì„œ ì¶”ì¶œ:

- íŒŒì¼ë³„ ì»¤ë²„ë¦¬ì§€ í¼ì„¼íŠ¸
- ë¯¸ì»¤ë²„ ë¼ì¸ ë²ˆí˜¸
- ë¯¸ì»¤ë²„ ë¸Œëœì¹˜ ì •ë³´
- ì „ì²´ ì»¤ë²„ë¦¬ì§€ í¼ì„¼íŠ¸

---

### Phase 2: Gap Classification (ê°­ ë¶„ë¥˜)

ê° ë¯¸ì»¤ë²„ ë¼ì¸/ë¸Œëœì¹˜ì— ëŒ€í•´ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì½ê³  ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¡œ ë¶„ë¥˜í•©ë‹ˆë‹¤:

#### âœ… COVERABLE â€” í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ì•¼ í•¨

ì •ìƒì ì¸ ì¡°ê±´ì—ì„œ ë„ë‹¬ ê°€ëŠ¥í•œ ë¼ì¸. ì˜ˆì‹œ:

- ì‹¤ì œ ì˜¤ë¥˜ ì‹œë‚˜ë¦¬ì˜¤ì˜ ì˜ˆì™¸ í•¸ë“¤ëŸ¬ (íƒ€ì„ì•„ì›ƒ, ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬, I/O ì‹¤íŒ¨)
- í…ŒìŠ¤íŠ¸ì—ì„œ ì•„ì§ í˜¸ì¶œë˜ì§€ ì•Šì€ ê³µê°œ API
- ìœ íš¨í•œ ì…ë ¥ ë³€í˜•ì— ëŒ€í•œ ì¡°ê±´ ë¶„ê¸°
- ëˆ„ë½ëœ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ ìˆëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜

#### âš ï¸ DEFENSIVE â€” `# pragma: no cover` ë§ˆí‚¹

êµ¬ì¡°ì ìœ¼ë¡œ ë„ë‹¬ ë¶ˆê°€ëŠ¥í•˜ì§€ë§Œ ì•ˆì „ ì¥ì¹˜ë¡œ ì¡´ì¬í•˜ëŠ” ì½”ë“œ. ì˜ˆì‹œ:

- Pydantic/TypeScript ê²€ì¦ì´ íƒ€ì…ì„ ë³´ì¥í•œ í›„ì˜ íƒ€ì… ê°€ë“œ
- ì™„ì „í•œ `if/elif` ì²´ì¸ ë’¤ì˜ `else` ë¶„ê¸°
- ìƒì„±ìê°€ í•­ìƒ ê°’ì„ í• ë‹¹í•˜ëŠ” í•„ë“œì˜ null ì²´í¬
- frozen/immutable ëª¨ë¸ ë³€ê²½ì— ëŒ€í•œ í´ë°± ì½”ë“œ

#### âŒ ENVIRONMENT-DEPENDENT â€” `# pragma: no cover` ë§ˆí‚¹

ë‹¤ë¥¸ ëŸ°íƒ€ì„ ì¡°ê±´ì—ì„œë§Œ ë„ë‹¬ ê°€ëŠ¥í•œ ì½”ë“œ. ì˜ˆì‹œ:

- Python ë²„ì „ í˜¸í™˜ ë¶„ê¸° (`try: ExceptionGroup except NameError:`)
- OSë³„ ì½”ë“œ (`if sys.platform == 'win32':`)
- ì„ íƒì  ì˜ì¡´ì„± ì„í¬íŠ¸ (`try: import uvloop except ImportError:`)

#### ğŸ”´ DEAD CODE â€” ì œê±° ê¶Œê³ 

ì–´ë–¤ ì¡°ê±´ì—ì„œë„ ë„ë‹¬í•  ìˆ˜ ì—†ëŠ” ì½”ë“œ. ì˜ˆì‹œ:

- ë¬´ì¡°ê±´ì  `return`/`raise` ì´í›„ì˜ ì½”ë“œ
- í•­ìƒ True/Falseì¸ ì¡°ê±´ì— ì˜í•œ ë¶„ê¸°
- ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” í•¨ìˆ˜/ë©”ì„œë“œ

---

### Phase 3: Test Implementation (í…ŒìŠ¤íŠ¸ êµ¬í˜„)

#### 3.1 Write Tests for âœ… COVERABLE Lines

ê° ì»¤ë²„ ê°€ëŠ¥í•œ ê°­ì— ëŒ€í•´:

1. **ìµœì†Œí•œì˜ í…ŒìŠ¤íŠ¸**ë¥¼ ì‹ë³„í•˜ì—¬ ë¯¸ì»¤ë²„ ê²½ë¡œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
2. **ì˜¬ë°”ë¥¸ ëª¨í‚¹ ì „ëµ**ì„ ì„ íƒí•©ë‹ˆë‹¤ (ì•„ë˜ íŒ¨í„´ ì°¸ì¡°).
3. **í”„ë¡œì íŠ¸ ì»¨ë²¤ì…˜**ì— ë§ê²Œ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
4. **ì¦‰ì‹œ ì‹¤í–‰**í•˜ì—¬ í†µê³¼í•˜ê³  ëŒ€ìƒ ë¼ì¸ì„ ì»¤ë²„í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

##### Mock Pattern Reference (Python async)

`async with session.get(url) as response:` íŒ¨í„´ ëª¨í‚¹ ì‹œ:

```python
# âœ… CORRECT: session.get()ì´ ë°˜í™˜í•˜ëŠ” context managerë¥¼ ëª¨í‚¹
mock_session = AsyncMock(spec=aiohttp.ClientSession)
mock_ctx = AsyncMock()
mock_ctx.__aenter__.side_effect = asyncio.TimeoutError()
mock_session.get.return_value = mock_ctx

result = await obj._method(mock_session, request)

# âŒ WRONG: async context managerì— ì‘ë™í•˜ì§€ ì•ŠìŒ
mock_session.get.side_effect = asyncio.TimeoutError()
```

##### Test Quality Checklist

ì‘ì„±í•œ ê° í…ŒìŠ¤íŠ¸ì— ëŒ€í•´ í™•ì¸:

- [ ] **Deterministic**: ì™¸ë¶€ ìƒíƒœ ì—†ì´ í•­ìƒ ë™ì¼í•œ ê²°ê³¼?
- [ ] **Isolated**: ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ê°€?
- [ ] **Observable**: í…ŒìŠ¤íŠ¸ ì´ë¦„ì´ ê²€ì¦ ì˜ë„ë¥¼ ëª…í™•íˆ ì „ë‹¬í•˜ëŠ”ê°€?
- [ ] **Contract**: í•¨ìˆ˜ì˜ ì‚¬ì „/ì‚¬í›„ ì¡°ê±´ì„ ê²€ì¦í•˜ëŠ”ê°€?
- [ ] **Assertion Quality**: ë‹¨ìˆœ `assert True`ê°€ ì•„ë‹Œ, êµ¬ì²´ì ì¸ ê°’/íƒ€ì…/ì†ì„±ì„ ê²€ì¦í•˜ëŠ”ê°€?

#### 3.2 Apply `# pragma: no cover` for âš ï¸ and âŒ Lines

ë°©ì–´ì /í™˜ê²½ ì˜ì¡´ ì½”ë“œì— ëŒ€í•´:

1. `# pragma: no cover` ë’¤ì— ëŒ€ì‹œ(`â€”`)ë¡œ êµ¬ë¶„ëœ ì¸ë¼ì¸ ì‚¬ìœ ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
2. ì‚¬ìœ ì—ëŠ” ë‹¤ìŒì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤:
   - **WHY**: ì´ ë¼ì¸ì´ ë„ë‹¬ ë¶ˆê°€ëŠ¥í•œ ì´ìœ 
   - **WHEN** (í•´ë‹¹ ì‹œ): ë„ë‹¬ ê°€ëŠ¥í•´ì§ˆ ìˆ˜ ìˆëŠ” ì¡°ê±´

ì˜ˆì‹œ:

```python
except NameError:  # pragma: no cover â€” Python 3.11 ë¯¸ë§Œì—ì„œë§Œ ì‹¤í–‰; ë‹¨ì¼ í™˜ê²½ CIì—ì„œëŠ” êµ¬ì¡°ì ìœ¼ë¡œ ì»¤ë²„ ë¶ˆê°€
if isinstance(data, MyModel):  # pragma: no cover â€” Pydantic v2 frozen ëª¨ë¸ ìµœì í™”ë¡œ ì´ ë¶„ê¸°ì— ë„ë‹¬ ë¶ˆê°€; ë°©ì–´ì  ì½”ë“œ
```

#### 3.3 Handle ğŸ”´ Dead Code

- ë°ë“œ ì½”ë“œë¥¼ íŒŒì¼ ê²½ë¡œì™€ ë¼ì¸ ë²ˆí˜¸ì™€ í•¨ê»˜ ì‚¬ìš©ìì—ê²Œ ë³´ê³ í•©ë‹ˆë‹¤.
- **ìë™ìœ¼ë¡œ ì œê±°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**
- ê·¼ê±°ì™€ í•¨ê»˜ ì œê±°ë¥¼ ê¶Œê³ í•©ë‹ˆë‹¤.

---

### Phase 4: Verification (ê²€ì¦)

#### 4.1 Run Final Coverage

ëª¨ë“  ë³€ê²½ í›„ ì»¤ë²„ë¦¬ì§€ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ì—¬ í™•ì¸:

- ëª¨ë“  ìƒˆ í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•˜ëŠ”ê°€
- ì»¤ë²„ë¦¬ì§€ê°€ í–¥ìƒë˜ì—ˆëŠ”ê°€
- ê¸°ì¡´ í…ŒìŠ¤íŠ¸ì— íšŒê·€ê°€ ì—†ëŠ”ê°€

#### 4.2 Produce Coverage Report

êµ¬ì¡°í™”ëœ ìš”ì•½ì„ ì¶œë ¥í•©ë‹ˆë‹¤:

```markdown
## Coverage Report

### Before â†’ After

| Metric          | Before | After |
| --------------- | ------ | ----- |
| Total Coverage  | X%     | Y%    |
| Tests           | N      | M     |
| Uncovered Lines | A      | B     |

### Changes Made

#### Tests Added

| Test                           | Target             | Type | Principle Verified |
| ------------------------------ | ------------------ | ---- | ------------------ |
| `test_timeout_returns_failure` | downloader.py L199 | Mock | Error Path Parity  |
| `test_normalize_with_string`   | request.py L184    | Unit | Contract-Driven    |

#### Pragma Annotations Added

| File                 | Line | Category      | Reason                |
| -------------------- | ---- | ------------- | --------------------- |
| validation_errors.py | 5-6  | ENV-DEPENDENT | Python 3.11 ë¯¸ë§Œ í˜¸í™˜ |

#### Dead Code Found

| File   | Line | Recommendation |
| ------ | ---- | -------------- |
| (none) | â€”    | â€”              |

### Remaining Gaps

(ë¯¸ì»¤ë²„ ë¼ì¸ì´ ë‚¨ì•„ìˆë‹¤ë©´ ì‚¬ìœ ì™€ ì¤‘ìš”ë„ë¥¼ ì„¤ëª…)
```

---

### Phase 5: Communicate Impossibility (ë¶ˆê°€ëŠ¥ì„± ì „ë‹¬)

100% ì»¤ë²„ë¦¬ì§€ê°€ êµ¬ì¡°ì ìœ¼ë¡œ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°, **ë°˜ë“œì‹œ ëª…ì‹œì ìœ¼ë¡œ** ì „ë‹¬í•©ë‹ˆë‹¤:

> âš ï¸ **100% ì»¤ë²„ë¦¬ì§€ ë‹¬ì„± ë¶ˆê°€**: ë‹¤ìŒ Nê°œ ë¼ì¸ì€ í˜„ì¬ í™˜ê²½ì—ì„œ êµ¬ì¡°ì ìœ¼ë¡œ ì»¤ë²„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
> ê° ë¼ì¸ì— `# pragma: no cover`ì™€ ì‚¬ìœ ë¥¼ ëª…ì‹œí–ˆìŠµë‹ˆë‹¤.
>
> **ê°œì„  ê°€ëŠ¥ì„±**: ë‹¤ì¤‘ Python ë²„ì „ CI ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ ë„ì…í•˜ë©´ Nê°œ ì¤‘ Mê°œë¥¼ ì¶”ê°€ë¡œ ì»¤ë²„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì ˆëŒ€ ë¯¸ì»¤ë²„ ë¼ì¸ì„ **ì¹¨ë¬µ ì†ì—** ë„˜ê¸°ì§€ ì•ŠìŠµë‹ˆë‹¤. í•­ìƒ ë³´ê³ í•©ë‹ˆë‹¤.

100% ì»¤ë²„ë¦¬ì§€ê°€ ë‹¬ì„±ëœ ê²½ìš°ì—ë„ `# pragma: no cover`ë¡œ ì œì™¸ëœ ë¼ì¸ë“¤ì„ ëª…ì‹œí•©ë‹ˆë‹¤:

> âœ… **100% ì»¤ë²„ë¦¬ì§€ ë‹¬ì„±** (`# pragma: no cover`ë¡œ ì œì™¸ëœ Nê°œ ë¼ì¸ í¬í•¨)
> ì œì™¸ëœ ë¼ì¸ë“¤ì˜ ì‚¬ìœ :
>
> 1. `file.py:L5` â€” ENV-DEPENDENT: ...
> 2. `file.py:L92` â€” DEFENSIVE: ...
